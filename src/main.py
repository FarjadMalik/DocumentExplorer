import nltk

from src.utils.scrapper import fetch_html_paragraphs
from src.utils.text_pipeline import *
# from src.utils.md_writer import write_to_markdown
from src.utils.logger import get_logger

logger = get_logger(__name__)


def main():
    url = "https://www.sciencespo.fr/mass-violence-war-massacre-resistance/fr/document/calcutta-riots-1946.html"
    output_path = "outputs/"
    
    logger.info(f"Article - \n{url}")
    try:
        # Get all text within url of interest

        # text_paragraphs = fetch_html_paragraphs(url)
        text_paragraphs = ['The Calcutta Riots of 1946, also known as the â\x80\x9cGreat Calcutta Killing,â\x80\x9d were four days of massive Hindu-Muslim riots in the capital of Bengal, India, resulting in 5,000 to 10,000 dead, and some 15,000 wounded, between August 16 and 19, 1946. These riots are probably the most notorious single massacre of the 1946-47 period, during which large-scale violence occurred in many parts of India. However, the â\x80\x9cGreat Calcutta Killingâ\x80\x9d stands out somewhat in the history of Calcutta, given that it was by far the most deadly episode in the recent history of the city. Although it received its name very soon after the events, it remains a very controversial episode, and different views or interpretations of it were put forward from Britain, India, Pakistan and Bangladesh. While there is a certain degree of consensus on the magnitude of the killings (although no precise casualty figures are available), including their short-term consequences, controversy remains regarding the exact sequence of events, various actorsâ\x80\x99 responsibility, and the long-term political consequences.', 'The event must be situated in two different, yet interrelated contexts: firstly the all-India context, and secondly the Bengal one. The former was marked by growing tension between the Congress Party, the main Indian nationalist organization with a base mostly (but not exclusively) among the Hindu population of the country, and the Muslim League, the main organization representative of the Muslim minority, which comprised almost 25% of Indiaâ\x80\x99s population. Tensions were largely due to the fact that both groups were gearing up for a transfer of power from the British, which Prime Minister Clement Attlee had announced in March 1946, without fixing a date, however. Each group had very different ideas regarding the future shape of the subcontinent. In 1940, the Muslim League passed a resolution in favor of the creation of Pakistan. It was not clear, however, whether it was meant to be a separate Muslim state or a part of a confederation with the rest of India (Jalal, 1985). The British still hoped that a partition of India could be avoided and were trying to come to an agreement with both the Congress and the League. In a statement on May 16, 1946, a British Cabinet Mission proposed a plan for the formation of an interim government composed of representatives from the Congress, the League, and other forces. This plan gave the Congress one more seat than the League. After weeks of behind-the-scene negotiations, on July 29, 1946, at the prompting of its leader Muhammad Ali Jinnah, the Muslim League adopted a resolution rejecting the May 16th plan and called on Muslims throughout India to observe a â\x80\x9cDirect Action Dayâ\x80\x9d in protest on August 16.', 'The announcement of a transfer of power in the near future had further exacerbated a situation that was already very tense in India. It intensified a growing polarization between the two main political parties and the two major religious communities. In the 1945-46 elections, both at the national and at the provincial level, Congress had won most of the seats in the Hindu majority areas and the Muslim League in the Muslim majority areas. The League had not, however, been able to gain a majority in the Punjab, the richest Muslim majority province, and therefore was tempted to use extra-constitutional means to reach its goals. Given that the country had a long history of â\x80\x9ccommunalâ\x80\x9d riots flaring up regularly since 1926 between Hindus and Muslims, there was understandably great fear of an outburst of violence, but the presence of the British Army in relatively large numbers, although resented by most, seemed to offer some guarantee of a peaceful transition. However, it was not to be, and the August 1946 events in Calcutta were to play a major role in triggering a whole spiral of violence that would engulf parts of India for many months.', 'The situation in Bengal was particularly complex. In the province, Muslims represented the majority of the population (54%, as against 44% of Hindus) and were mostly concentrated in the Eastern part (present-day Bangladesh). As a result of this demographic structure and specific developments, this province was the only one in which a Muslim League government was in power (under a regime of provincial autonomy introduced in 1935), in coalition with Europeans, and in the face of strong opposition from the Congress Party and from a Hindu nationalist party. The latter, the Hindu Mahasabha was supported by many members of the rich Marwari trading community, composed of immigrants from Rajasthan, who largely dominated the economy of Calcutta and of Bengal (although European capital was still important). The leader of the Muslim League in Bengal and Chief Minister of the province wasHussain Suhrawardy. Suhrawardy, a rival ofJinnahfor the leadership of the League, was a controversial, albeit colorful personality who became very unpopular amongst large sections of the Hindu population for his alleged responsibility in the great Bengal famine of 1943, which had resulted in the death of two to three million people. However, he was idolized by many Muslims in Bengal, particularly by the Urdu-speaking Muslims from Northern India, who formed the majority of Calcuttaâ\x80\x99s Muslim population (Bengali Muslims, who accounted for the bulk of the Muslim population in the province, were mostly concentrated in the countryside). Calcutta itself had a clear Hindu majority (73% of the population according to the 1941 Census) and a significant Muslim minority (23% of the population). Given the tendency of the population in urban areas to congregate in neighborhoods dominated by one community, most Muslims lived in areas of Northern Calcutta, while Central and Southern Calcutta were almost exclusively Hindu (with a sprinkling of Europeans). Another characteristic of Calcuttaâ\x80\x99s Muslim population was that it was largely composed of poor people, mostly artisans, factory workers, rickshaw pullers and domestic servants. The Muslim middle class in Calcutta was small, in contrast to the much larger Hindu middle class. Big Muslim merchants and capitalists were few, and could not compete with the rich Marwari Hindus. Although Muslims were clearly a minority in Calcutta and occupied a peripheral position in the economic, social and cultural life of the city, the capital was the only large city in the province, and therefore occupied a privileged position in all provincial politics, whether Muslim or Hindu. Suhrawardy had a particularly large following amongst the poor Muslims of the city, and was also rumored to have close links to the Muslim underworld, which played a significant role in the parallel economy, based on smuggling, gambling and prostitution, which flourished in the great port-city.', 'Jinnah had called for peaceful demonstrations all over India on Direct Action Day, and most of India, including the Muslim-majority provinces of the Punjab and Sind (in the latter the Muslim League was part of a coalition government) remained calm. In Bengal, however, and specifically in Calcutta, the events took a violent turn, and quickly spun completely out of control.', 'Controversy still rages about the respective responsibilities of the two main communities, the Hindus and the Muslims, in addition to individual leadersâ\x80\x99 roles in the carnage. The dominant British view tends to blame both communities equally and single out the calculations of the leaders and the savagery of the followers, amongst whom there were criminal elements (Tuker, 1950). In the Congressâ\x80\x99 version of the events (Bose, 1968), the blame tends to be squarely laid on the Muslim League and in particular on the Chief Minister of Bengal, Suhrawardy. The view from the Muslim League side, nowadays partly upheld in Bangladesh, the successor state to East Pakistan, is that in fact Congress and the Hindus used the opportunity offered by Direct Action Day to teach the Muslims in Calcutta a lesson and kill them in great numbers (Rashid, 1987). Thus, the riots opened the way to a partition of Bengal between a Hindu-dominated Western Bengal including Calcutta, and a Muslim-dominated Eastern Bengal (nowadays Bangladesh).', 'There is an explicit accusation in pro-Congress accounts (partly upheld in British sources) that Suhrawardyâ\x80\x99s attitude overtly incited violence. The two main points emphasized are:', '-Suhrawardy positioned himself with his cronies in the Police Control Room, and thus prevented the Police Commissioner, a British national who was technically in charge of law and order, from attending to the trouble with a free mind;', '-# at the meeting held in theMaidan, a vast open space in central Calcutta, Suhrawardy told the Muslim League crowd (estimated to have been at least 100,000 strong) that he had taken measures to â\x80\x9c restrainâ\x80\x9d the police, which was interpreted by many in the crowd as a license to loot and kill.', 'Suhrawardyâ\x80\x99s apologists (Taukdar 1987) answer:', '-# that his presence in the Police Control Room was an attempt to get a better hold on law maintenance operations and not meant as a hindrance', '-# that in the absence of any transcript of Suharawardyâ\x80\x99s speech (due to the fact that the Police Special Branch did not have an Urdu stenographer on hand, which in retrospect, seems to have been an incredible oversight), the accusations regarding his inflammatory language cannot be substantiated.', 'The main accusations leveled at Governor Burrows in pro-Congress accounts are:', '-# that he allowed Suhrawardy to interfere with law and order operations while his reserve powers allowed him to prevent Suhrawardy from doing so;', '-# that he took too long to realize the extent of the trouble, and called the troops in when things had already gotten out of hand; an earlier intervention by the military might have been able to save the day.', 'To these reproaches, Burrowsâ\x80\x99 answer was:', '-# that he could not have prevented Suhrawardy from interfering without triggering a major political crisis with country-wide repercussions, at a particularly delicate moment;', '-# that he called the troops in as soon as he had enough of them available to make a difference.', 'Their exact number is not and will never be known. Authorities have compiled various official estimates on the basis of a rough body count, but none appear too reliable. The most widely accepted figure of dead is situated between a minimum of 5,000 and a maximum of 10,000 (Chatterjee, 1991), and the number of wounded is generally put at around 15,000, but it is not clear on what this figure is based, apart from guess work. In any case, such uncertainty is a common feature of most massacres in India. The reasons for this uncertainty are complex, ranging from the low degree of penetration of State institutions in society, to the absence of reliable registration of deaths. To these structural reasons, we must add a more temporary factor, the disorganization of public administration in a period of rapid political change and turmoil.', 'Three points need to be emphasized. The first one is the particularly savage manner in which the killings were executed. Not only were victims brutally killed, they were also grotesquely mutilated. This kind of grisly â\x80\x9critualâ\x80\x9d was very much part of the repertoire of communal killings in India; what was new in Calcutta was the sheer scale of the phenomenon. Secondly, most accounts mentioned cases of rape, which were not part of the usual gamut of communal riots in India, but were to figure prominently in accounts of communal violence around the time of Partition, which in retrospect, makes the Great Killing a sad harbinger of horrors still to come. Though women and children figure among the victims, they were not as prominently represented as it was the case in the Punjab massacres a year later, however, and most of the Great Killing victims were adult males. The third point, difficult to verify, but plausible in view of the general â\x80\x9csocial ecologyâ\x80\x9d of massacres in India, is that, while the perpetrators often belonged to the so-called â\x80\x9cunderworld,â\x80\x9d the victims themselves were overwhelmingly poor and defenseless. This links with a final, very important point: according to most accounts the majority of the victims were Muslims; however, due to the absence of reliable figures this can never be demonstrated. Since most Muslims in Calcutta were poor, there seems to be a certain coincidence between the religious and the social content of the massacre. Few rich Hindus or Muslims appear to have been targeted, although Muslim crowds attacked the houses of some rich Hindus, from which their owners had absconded. Thus, the massacre could be described as the combination of one large pogrom against poor Muslims by Hindu toughs, with one smaller pogrom against poor Hindus by Muslim toughs. A number of people must also have been killed in the crossfire between the two communities, and quite a few killed by police and Army fire, adding to the complexity of the massacre.', 'Many people witnessed the massacre, but there are few reliable testimonies on which to draw. In August 1946, the Government of Bengal appointed an enquiry commission presided by the Supreme Justice of India, Sir Patrick Spens. Although the commission interrogated many witnesses, its conclusions were never published. These findings have nonetheless been widely used by a Bengali historian (Das,1991). The memoirs of Lieutenant General Sir Francis Tuker, then in command of British and Indian forces in the Eastern sector of India, provide a fairly detailed, although heavily biased, first-hand account (Tuker, 1950). These memoirs embody a British view of the events which tends to distribute blame more or less equally between the two communities, but nevertheless displays a slight pro-Muslim and a strong anti-Congress bias. A few other British witnesses have left written accounts. There is a wide array of personal reminiscences by inhabitants of Calcutta who witnessed the events, published in Bengali, but they have not been the object of a systematic study.', 'Apart from the official enquiry report that was never published, no effort seems to have been made at collecting testimony from direct witnesses. It is not too difficult to understand why. Narratives of the event became very much part of identity politics in a city which remained seriously divided until the middle of 1947, whenGandhiâ\x80\x99s â\x80\x9cpeace missionâ\x80\x9d brought in a respite which eventually became lasting. Thus, nobody was interested in a â\x80\x9ctrueâ\x80\x9d account, and witnesses were considered necessarily partial if they were either Hindus or Muslims. With regard to the British, they faded from the scene after August 1947. Rather than comparing witnessesâ\x80\x99 accounts of various origins, it became a question of â\x80\x9courâ\x80\x9d witnesses versus â\x80\x9ctheirs.â\x80\x9d In the period between August 1946 and August 1947, if you were a Hindu, you believed in one narrative that blamed Suhrawardy and the Muslim League entirely, and saw the violent acts by Hindu crowds as simply a matter of self-defense, and you could quote plenty of â\x80\x9cwitnessesâ\x80\x9d to support your claim. If you were a Muslim, you tended to adopt a discourse of victimization and to point to the fact that most of the victims were Muslims, hinting at a dark Hindu plot to wipe out Muslims in Calcutta. After independence and partition, when the two communities had perforce found a way of living together more or less peacefully (since few Muslims left Calcutta for East Pakistan), a heavy silence descended on the event, and it remained buried in that silence for decades.', 'In a paradoxical way, one could say that on the one hand, the Great Calcutta Killing is very much an object of living memory; narratives are handed down from one generation to another within practically all the families who lived through it. On the other hand, it is conspicuously absent from the official memory of Bengal, particularly on the West Bengal side, but also, in a more surprising way, on the Bangladeshi side. The disjunction between private memory and public and official memory is not unique to this particular event. This disjunction occurs with most traumatic events. For example, the Holocaust in the immediate post-war period, before the outset of the era of commemoration in the 1960s, is a case in point.', 'Given the lack of study on this aspect, one can only point to some of the possible reasons for the absence of an official memory of the Great Killing. On the Indian side, political expediency is the most plausible. Following independence, dwelling on past events was seen as a diversion from the task of building a new country, free from colonial shackles. Besides, as already mentioned, most Muslims stayed in Calcutta after Partition; only some rich merchants and middle-class people emigrated to East Pakistan; the mass of the poor had to survive in the new context and harping on the memory of the massacre was likely to bring them no benefit of any kind. In regard to the Hindus, who had had the better in the fight, they found it preferable to adopt a low profile and to play the appeasement card. On the Pakistani side, the question was complicated by the fact that, from the early 1950s onwards, Bengalis in East Pakistan felt increasingly alienated from their West Pakistan compatriots and were nostalgic for the time when Bengal had been united. Therefore, they were not interested in reviving old wounds. The same attitude persisted in 1971 after Bangladesh gained independence from Pakistan with the help of India. Although there was a change of regime in 1975 and a worsening of relations with India, there was no significant attempt at creating a memory of the 1946 killings. One of the reasons probably was that Suhrawardy, who wasMujibur Rahmanâ\x80\x99s political mentor, is considered a kind of national hero in Bangladesh. This said, his admirers are not keen to dwell upon his role in 1946. Thus, there was a kind of conspiracy of silence which only began to be lifted in the 1990s, when the advent of a new historiography in India led to reconsideration of a whole part of the Indian past, that had previously been believed to be better off forgotten. Yet the Great Calcutta Killing, or rather the Calcutta Riots of 1946 (the expression most often used) remain a marginal episode in the dominant narrative of the history of Bengal.', 'In the scholarly literature about the event, which is scarce (there is no book or article specifically devoted to the Great Calcutta Killing), two main strands of interpretation can be discerned. One tends to emphasize continuity, showing that the 1946 riots were mostly a culmination of trends towards growing inter-communal violence in Bengal, but did not represent a radically novel development. The other places the violence more specifically within the context of the Partition and stresses its instrumentality to the goals pursued by certain actors, in particular Hindu politicians.', 'The first strand is represented in particular in Suranjan Dasâ\x80\x99s book on communal violence in Bengal, which includes a substantial section devoted to the 1946 riots. Dasâ\x80\x99s overall argument revolves around a distinction between what he calls â\x80\x9celite communalismâ\x80\x9d and what he calls â\x80\x9cmass communalism.â\x80\x9d He argues that communalism was originally more of an elite phenomenon, born in the intelligentsia and the middle classes, but that it tended to spread to the masses if certain circumstances were favorable to that. To him, the Great Killing is a spectacular instance of the spread of elite communalism to the masses. This leads him to pay particular attention to the participation of ordinary people in the violence, using police and court records, as well as some of the unpublished witness testimonies to the Spens Inquiry Commission (Das, 1991). He mentions that clashes between the two communities took two different forms: on the one hand, open street battles between large crowds, and on the other hand, sporadic acts by small roving bands. The latter often targeted passers-by, and their acts had a random character which contributed to giving the impression that things had gotten completely out of hand, while in fact part of the killings appear to have taken place in large-scale confrontations between â\x80\x9corganizedâ\x80\x9d crowds. Amongst Muslims, Das is able to show that some professional groups were particularly represented: butchers seem to have been prominent and they came with their meat-choppers which, in experienced hands, could be a lethal weapon (this is reminiscent of the original meaning of the old French word â\x80\x9cmassacre,â\x80\x9d which refers precisely to the butcherâ\x80\x99s chopper). Amongst Hindus, dharwans (janitors), who often had links to criminals, also figured prominently, giving the violent crowds a plebeian aspect, which is not really very surprising in the urban milieu of Calcutta. In many ways, this city was still pre-industrial, even though there were large concentrations of factory workers in the suburban industrial belt (some of whom also appear to have been involved in the rioting).', 'The second strand is represented in particular by Joya Chatterjiâ\x80\x99s book (Chatterji, 1995). Her central argument is that the partition of Bengal mostly resulted from the actions of Hindu elite politicians, who were opposed to the rule of the Muslim majority. In this perspective, she instills great importance in the episode of the 1946 riots, which allowed the Hindus to take physical control of the city. She therefore tends to dwell upon the role played by different Hindu organized groups (mostly linked to the Congress Party and the HinduMahasabha) in the violence. She gives particular importance to one such group, calledBharat Sevashram Sangha, close to theMahasabha. These groups had many middle-class members and some of them were very active during the riots. Chatterji sees elite manipulation of Hindu crowds as an essential aspect of the violence, but she is less interested in exploring the nature of Muslim violence.', 'Both authors stress the active participation of those more or less criminal elements of the population who are known in India under the appellation of â\x80\x9cgoondas.â\x80\x9d One particular difficulty is that there is no generally accepted definition of the word â\x80\x9cgoonda.â\x80\x9d The term can refer to a local tough, adada(â\x80\x9celder brotherâ\x80\x9d) who terrorizes a neighborhood and extracts protection money from it, but who also does â\x80\x9cprotectâ\x80\x9d it against outsiders and the intrusions of State authorities. This person is often connected to a political party. The term can also refer to a member of an organized gang of the vast Calcutta underworld engaged in various dubious activities such as prostitution, gambling or smuggling. Whiledadasby and large reflected the religious composition of their neighborhood (for instance in a Hindu neighborhood, you had Hindudadas, and in a Muslim neighborhood Muslimdadas), the underworld was generally more mixed: Hindu and Muslim gangsters and pimps are known to have operated largely across religious barriers. It is plausible nevertheless that, in the atmosphere of extreme communal tension such as the one prevailing in Calcutta in 1946, even gangsters and pimps felt the strong pull of religion and community. It is among those â\x80\x9ccriminalâ\x80\x9d elements that one finds some of the few conspicuous participants, who attracted attention because of their particular efficiency at killing and their capacity to inspire crowds to violent action.', 'To the question as to why the killings took such a savage form, much beyond what had been witnessed in previous â\x80\x9ccommunalâ\x80\x9d riots (but less than what was witnessed during the Partition massacres in the Punjab), none of the authors formulate a very convincing answer. By default, they seem to settle for a response couched in Durkheimian terms, stressinganomieand the breakdown of societal links in a situation of extreme tension between the two major communities of the city. Although infinitely superior to the standard explanation in terms of the â\x80\x9canimalâ\x80\x9d passions of the crowds or the innate sadism of the â\x80\x9cgoondas,â\x80\x9d it seems lacking nevertheless. In fact, there may have been very rational calculations at work on the side of the instigators and perpetrators of the killings. It was actually a fight over who was to be master of Calcutta. By organizing huge demonstrations, occupying theMaidanand using whatever State power it had at its disposal, the Bengal Provincial Muslim League was trying to stake its claim to Calcutta as the capital of a Muslim Bengal, which would be part of Pakistan, whose shape was still hazy at the time. A massacre was probably not the Leagueâ\x80\x99s goal (although one pamphlet circulating amongst Muslims warned of a â\x80\x9cgeneral massacreâ\x80\x9d ofKafirs, infidels, i.e. Hindus), but the Leagueâ\x80\x99s supporters did not shrink from using violence on a significant scale to advance their objectives. Although the use of violence by a minority against the majority could appear irrational to us, in the mindset of many Muslims at the time it was not so, because they considered the Hindus cowardly and effeminate, and thought they were no match for Muslims in an open fight. As for the â\x80\x9cHinduâ\x80\x9d political parties, both Congress and theMahasabhawere bent on making a counter-demonstration of their superior muscle power. Therefore, they were not adverse to large-scale killings to decisively defeat the Muslim Leagueâ\x80\x99s attempts to impose its dominance. The massacre was the result of the clash of two wills, between which no compromise was possible.', 'BOSE, S.C., 1968,I Warned My Countrymen, Being the Collected Works 1945-50 of Sarat Chandra Bose, Calcutta, Netaji Research Bureau.', 'CHATTERJEE, P.K., 1991,Struggle and Strife in Urban Bengal, 1937-1947, Calcutta, Das Gupta.', 'CHATTERJI, J., 1995,Bengal Divided: Hindu Communalism and Partition, 1932-1947, Cambridge, Cambridge University Press.', 'DAS, S., 1991,Communal Riots in Bengal 1905-1947, Delhi, Oxford University Press.', 'JALAL, A., 1985,The Sole Spokesman: Jinnah, the Muslim League and the Demand for Pakistan, Cambridge, Cambridge University Press.', 'RASHID, H. Ar, 1987,The Foreshadowing of Bangladesh: Bengal Muslim League and Muslim Politics 1936-1947, Asiatic Society of Bangladesh, Dhaka, 1987.', 'TAUKDAR, M.H.R. (ed.), 1987,Memoirs of Huseyn Shaheed Suhrawardy with a Brief Account of his Life and Work, University Press, Dhaka, 1987.', 'TUKER, F., 1950,While Memory Serves, London, Cassell & Co', 'WAVELL, Lord, 1997,The Viceroyâ\x80\x99s Journal, edited by P. Moon, Karachi, Oxford University Press, (1st ed., London, 1973).', 'The Asia-Pacific Journal', 'massviolence.resistance@sciencespo.fr']
        # logger.debug(f"text_paragraphs - {text_paragraphs}")

        tokenized_doc = tokenize_text("\n".join(text_paragraphs))
        # logger.debug(f"processed_text - {processed_text}")
        # logger.debug(f"doc - {doc}")
        logger.debug(f"doc tokens - {tokenized_doc}")
        vectorized_doc, vocab = count_vectorize_text("\n".join(text_paragraphs))
        logger.debug(f"vectorized_doc - {vectorized_doc}")
        logger.debug(f"vocab - {vocab}")

        # first_pass_summary = summarize_long_text(processed_text)
        # logger.debug(f"first_pass_summary - {first_pass_summary}")
        
        # final_summary = extract_summary(first_pass_summary)
        # logger.debug(f"final_summary - {final_summary}")
        
        # key_points = extract_key_points("\n".join(text_paragraphs))
        # cleaned = clean_and_tokenize("\n".join(text_paragraphs))
        # named_entities = extract_named_entities(processed_text)
        # logger.debug(f"key_points - {key_points}")
        # logger.debug(f"named_entities - {named_entities}")
        # logger.debug(f"cleaned - {cleaned}")
        # logger.info(f"Article summary and key points saved to {output_path}")
    
    except Exception as e:
        logger.error(f"Error: {e}")


if __name__ == "__main__":
    # nltk.download("punkt")
    # nltk.download("stopwords")
    # nltk.download('punkt_tab')
    main()
